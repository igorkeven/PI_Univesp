

<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <title>Marketplace de Produtos Artesanais </title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/cliente.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cliente.css') }}">

  </head>
  <body>
    <header>
      <nav>
        <ul>
          <li><a href="/">Página Inicial</a></li>
          <li class="sair" ><a href="/sair">Sair</a></li>
          
          
        </ul>
      </nav>
          </header>

          {% if dadosCliente['carrinho'] %}
          <h1 class="titulo" id="titulo">Seu carrinho</h1>
          {% else %}
          <h1 class="titulo" id="titulo">Seu carrinho esta Vazio</h1>
          <h3 class="menu_perfil ir2" id="paginainicial2" >click aqui e vá as compras</h3>
          {% endif %}
          
          
          {% set mensagens = get_flashed_messages() %}
          {% if mensagens %}
              <div id="alerta">
                  {{mensagens[0]}}
              </div>
          {% endif %}

          
    
    <main>
      <aside class="perfil">
        {% if not foto %}
        
          <img src="/static/arquivos/usuario.png" alt="Foto do artesão {{ nome }}" title="Enviar foto" id="foto-artesao">
        
        <br>
        <h1 class="nome">{{ nome }}</h1>
        {% else %}
        
          <img src="{{ url_for('static', filename='fotoPerfil/' + foto) }}" width="200" height="150" alt="Foto do artesão {{ nome }}" title="Mudar foto" id="foto-artesao">
          
          {% set menu_perfil_style = 'font-size: 18px;' %}
        <br>
        <h1 class="nome"> {{ nome }} </h1>
        {% endif %}
        <h3 class="menu_perfil"  id="escolha_formulario_senha" style="{{ menu_perfil_style|default('') }}" >Mudar senha</h3>
        <h3 class="menu_perfil" id="btnhistorico" style="{{ menu_perfil_style|default('') }}" >Historico de compras</h3>
        <h3 class="menu_perfil" id="paginainicial" style="{{ menu_perfil_style|default('') }}" >Ir as compras</h3>
        {% if dadosCliente['carrinho']  %}
        <h3 class="menu_perfil" id="meus_pedidos" style="{{ menu_perfil_style|default('') }}" > Meus Pedidos  </h3>
        
        <h3  > Total a pagar: {{dadosCliente['total_preco']}}</h3>
        <h3 class="menu_perfil" id="finalizarCompra" style="{{ menu_perfil_style|default('') }}">Finalizar compra</h3>
        {% endif %}
        <h3 class="apagar_conta" >Apagar minha conta</h3>
      </aside>
      
      <div class="produtos" id="produtos">
        
        {% if dadosCliente['carrinho'] %}
        
        {% for produto, dados in dadosCliente['carrinho'].items() %}

        <div class="produto">
          <img src="{{ url_for('static', filename='produtos/' + dados['imagem']) }}" alt="{{ produto }}" width="200">
          <h2>{{ produto }}</h2>
          <p>{{ dados['descricao'] }}</p>
          <p>Preço: R$ {{ dados['preco'] }}</p>
          {% for artesao in listaArtesao %}
          {% if dados['id_vendedor'] == artesao['id'] %}
          <p>vendedor: {{ artesao['nome'] }}</p>
          {% endif %}
          {% endfor %}
          
          
        

          <form action="/adicionarCarrinho" method="POST">
            <input type="hidden" name="imagem" value="{{ dados['imagem'] }}">
            <input type="hidden" name="discricao" value="{{ dados['discricao'] }}">
            <input type="hidden" name="preco" value="{{ dados['preco'] }}">
            <input type="hidden" name="nome_produto" value="{{produto}}">
            <input type="hidden" name="id_vendedor" value="{{dados['id_vendedor']}}">
            <input type="submit" value=" {{produto}} no carrinho&#10;quantidade: {{dados['quantidade']}}&#10;Adicionar + 1" >
            <input type="hidden" name="pagina" value="paginaCliente">
         
        </form>
        <br>

        <form action="/excluirItemCarrinho" method="post">
          <input type="hidden" name="nome_produto" value="{{produto}}">
          
          <input type="hidden" name="pagina" value="paginaCliente">
          <input type="hidden" name="emailCliente" value="{{dadosCliente['email']}}">
          <input type="submit" class="removerCarrinho" value="Remover do carrinho" >
        </form>
                              

         
        </div>


        {% endfor %}
        

        {% endif %}
       
      </div>
    
      <div id="formulario_senha">

        <form action="/mudar_senha" method="post" id="formMudarSenha">
          <label for="novaSenha">Nova Senha:</label>
          <input type="password" name="novaSenha" id="novaSenha" placeholder="Digite sua nova senha" required>
          <label for="repetirNovaSenha">Repetir Nova Senha</label>
          <input type="password" name="repetirNovaSenha" id="repetirNovaSenha" placeholder="Repetir Nova Senha" required>
          <input type="hidden" name="dadosUsuario" value="{{dadosCliente}}">
          <div id="mensagemErroSenha"></div>
          <input type="submit" value="Salvar">
        </form>

      </div>





      <div id="modal_apagarConta" class="modal_apagarConta">
        <div class="modal-content">
          <h4>Tem certeza que deseja apagar sua conta?</h4>
          <p class="apagarAlerta">Essa ação é permanente e não pode ser desfeita.</p>
          <div class="modal-buttons">
            <button id="cancelarApagarConta">Cancelar</button>
            
            <form action="/apagar_conta" method="post">
              <input type="hidden" name="EmailUsuario" value="{{dadosCliente['email']}}">
              
              <input type="submit"  id="confirmarApagarConta" value="Confirmar">
            </form>
            
          </div>
        </div>
      </div>
      


      <div class="historico" id="historico">
        {% if dadosCliente['historico'] %}
          {% for compra in dadosCliente['historico'] %}
            <h2 class="compra-realizada">Compra realizada em {{ compra['compra_feita_em'] }}</h2>
            {% for produto, dados in compra['compras_finalizadas'].items() %}
              <div class="produto">
                <img src="{{ url_for('static', filename='produtos/' + dados['imagem']) }}" alt="{{ produto }}" width="200">
                <h3>{{ produto }}</h3>
                <p>{{ dados['descricao'] }}</p>
                <p>Preço: R$ {{ dados['preco'] }}</p>
                {% for artesao in listaArtesao %}
                  {% if dados['id_vendedor'] == artesao['id'] %}
                    <p>Vendedor: {{ artesao['nome'] }}</p>
                  {% endif %}
                {% endfor %}
                <p>Quantidade: {{ dados['quantidade'] }}</p>
              </div>
            {% endfor %}
          {% endfor %}
        {% else %}
          <p>Nenhum histórico de compras encontrado.</p>
        {% endif %}
      </div>
      
      




    </main>
     
    <footer>
      <p>&copy; 2023 Marketplace de Produtos Artesanais Igor & Luiz</p>
    </footer>
    <script>
const irCompras = document.querySelector("#paginainicial");
const irCompras2 = document.querySelector("#paginainicial2");
const divProdutos = document.querySelector("#produtos");
const titulo = document.querySelector("#titulo");
const btnMudarSenha = document.querySelector("#escolha_formulario_senha");
const divFormularioSenha = document.querySelector("#formulario_senha");
const btnPedidos = document.querySelector("#meus_pedidos");
const historico = document.querySelector("#historico");
const btnhistorico = document.querySelector("#btnhistorico");
          // codigo para fazer aparecer o modal de confirmação de apagar a conta
const apagarContaButton = document.querySelector('.apagar_conta');
const modalApagarConta = document.querySelector('#modal_apagarConta');
const cancelarButton = document.querySelector('#cancelarApagarConta');






irCompras.addEventListener("click", () => {
  window.location.href = "/";
})


if (titulo.textContent === "Seu carrinho esta Vazio") {
  irCompras2.addEventListener("click", () => {
    window.location.href = "/";
  });
}




btnhistorico.addEventListener("click", () => {
historico.style.display = 'block';
divProdutos.style.display = "none";
divFormularioSenha.style.display = 'none';
titulo.textContent = "Meu Historico de compras";

})




if (titulo.textContent === "Seu carrinho") {
btnPedidos.addEventListener("click", () => {
divProdutos.style.display = "flex";
divFormularioSenha.style.display = 'none';
historico.style.display = 'none';
titulo.textContent = "Meu Carrinho";

})




document.getElementById('finalizarCompra').addEventListener("click", function () {
        
        var modal = document.createElement("div");
        modal.classList.add("modal");
        modal.innerHTML = `
        <div class="modal-content">
  <span class="close">&times;</span>
  <form action="/finalizarCompra" method="post" enctype="multipart/form-data">
    {% for artesao in  listaArtesao %}  
          {% for artesao_id, valor in valor_recebido_por_vendedor.items() %}       
            {% if artesao['id'] == artesao_id %}
            <h2>Pagar para {{artesao['nome']}} o valor de R$ {{valor}}<br>chave pix: {{artesao['chavePIX']}} </h2>
            <br><br>
              
            {% endif %}
          {% endfor %}
          {% endfor %}
          

    <input type="hidden" name="dadosCliente" value="{{dadosCliente }}" >
    <input type="submit" class="close" value="PAGO">
  </form>
</div>

        
        `;
        document.body.appendChild(modal);
        var closeButton = modal.querySelector(".close");
        closeButton.addEventListener("click", function() {
          modal.remove();
        });

        

      })
  

  } 



btnMudarSenha.addEventListener("click", () => {
  divFormularioSenha.style.display = 'flex';
  divProdutos.style.display = "none";
  historico.style.display = 'none';
  titulo.textContent = "Mudar Senha";
  
})




      document.getElementById("foto-artesao").addEventListener("click", function() {
        if (this.src.includes("usuario.png")) {
          // Usuário ainda não tem uma imagem definida, permitir a mudança da imagem sem alerta
        } else {
          // Usuário já tem uma imagem definida, solicitar confirmação antes de permitir a mudança da imagem
          if (confirm("Você tem certeza que deseja mudar sua foto?")) {
            // Usuário confirmou a mudança da foto
          } else {
            // Usuário cancelou a mudança da foto
            return;
          }
        }
        var modal = document.createElement("div");
        modal.classList.add("modal");
        modal.innerHTML = `
          <div class="modal-content">
            <span class="close">&times;</span>
            <form action="/enviar_foto" method="post" enctype="multipart/form-data">
              <input type="file" name="foto" id="foto" required>
              <input type="hidden" name="dadosUsuario" value="{{dadosCliente}}" >
              <input type="hidden" name="retornoRota" value="/cliente" >
              
              
              <input type="submit" value="Enviar">
            </form>
          </div>
        `;
        document.body.appendChild(modal);
        
        var closeButton = modal.querySelector(".close");
        closeButton.addEventListener("click", function() {
          modal.remove();
        });
      });
      

apagarContaButton.addEventListener('click', () => {
  modalApagarConta.style.display = "block";
});

cancelarButton.addEventListener('click', () => {
  modalApagarConta.style.display = "none";
});


      </script>
      
          <script src="/static/javascript/home.js"></script>
    <script src="{{ url_for('static', filename='javascript/home.js') }}"></script>
  </body>
</html>
